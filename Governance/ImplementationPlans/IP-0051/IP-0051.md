# IP-0051: PZR Temperature Visualization Enhancement

**Version:** v1.0  
**Date:** 2026-02-17  
**Domain Plan:** DP-0008 â€” Operator Interface & Scenarios  
**Status:** PENDING APPROVAL

---

## 1. Problem Summary

CS-0111 identifies critical operator visibility gaps for PZR temperature monitoring during cold startup:

1. **No T_pzr arc gauge** â€” The Pressurizer column has arc gauges for PRESSURE and LEVEL, but not temperature
2. **T_pzr readout misplaced** â€” Currently in RCS column instead of Pressurizer column
3. **No T_pzr sparkline trend** â€” Cannot observe heating trajectory toward saturation over time

Per NRC HRTD 17.0: "When pressurizer temperature reaches saturation temperature for the pressure being maintained (450Â°F for 400 psig), a pressurizer bubble is established." This makes T_pzr trajectory monitoring essential during cold startup.

**Root Cause:** Dashboard was designed with post-bubble operations as primary focus; pre-bubble PZR heating visualization was deprioritized.

---

## 2. Included CS Items

| CS ID | Title | Severity | Status |
|-------|-------|----------|--------|
| CS-0108 | PZR temperature monitoring missing for bubble formation readiness during cold startup | MEDIUM | READY |
| CS-0111 | PZR temperature (T_pzr) lacks primary visualization â€” no arc gauge or trend display | MEDIUM | READY |

---

## 3. Dependency Hierarchy Analysis

### 3.1 Prerequisites
- None. CS-0108 and CS-0111 are display-only and can execute within this IP scope.

### 3.2 Blocking Relationships
- None. No other CS depends on this.

### 3.3 Shared Files/Systems
| File | Also Used By | Interference Risk |
|------|--------------|-------------------|
| `ValidationDashboard.Snapshot.cs` | None pending | LOW |
| `Tabs/OverviewTab.cs` | None pending | LOW |
| `ValidationDashboard.Sparklines.cs` | None pending | LOW |

### 3.4 Interference Risk Assessment
**LOW** â€” Changes are isolated to display rendering. No physics modules affected.

### 3.5 Critical Path
Dual-CS execution (`CS-0108`, `CS-0111`) with shared UI files; execute sequentially to keep validation attribution clear.

---

## 4. Execution Order

| Stage | Description | CS | Est. Complexity |
|-------|-------------|-----|-----------------|
| 1 | Add T_pzr Arc Gauge to Pressurizer Column | CS-0111 | LOW |
| 2 | Remove T_pzr Readout from RCS Column | CS-0111 | LOW |
| 3 | Add T_pzr Sparkline Trend (replace NET HEAT) | CS-0111 | MEDIUM |
| 4 | Validation & Documentation | CS-0111 | LOW |

---

## 5. Expected Behavior (Acceptance Criteria)

| Criterion | Verification Method |
|-----------|-------------------|
| T_pzr arc gauge visible in Pressurizer column | Visual inspection |
| Gauge range 50-600Â°F appropriate for startup | Code review |
| Color indication based on saturation approach | Visual: cyan (subcooled) â†’ green (at saturation) |
| T_pzr readout removed from RCS column | Visual inspection |
| No duplicate T_pzr display | Visual inspection |
| T_pzr sparkline visible in Trends column | Visual inspection |
| Sparkline replaces NET HEAT (slot 7) | Code review |
| Sparkline shows ~1 hour history | Observation during runtime |
| Existing PZR Î”T_SAT readout still visible | Visual inspection |

---

## 6. Proposed Implementation

### Stage 1: Add T_pzr Arc Gauge to Pressurizer Column

**File:** `Assets/Scripts/Validation/Tabs/OverviewTab.cs`

**Location:** `DrawPressurizerColumn()` method, after LEVEL arc gauge (around line 295)

**Implementation:**
```csharp
// T_pzr arc gauge (for bubble formation readiness monitoring)
Vector2 tpzrCenter = new Vector2(centerX, y + 30f);
Color tpzrColor = s.PzrAtSaturation 
    ? ValidationDashboard._cNormalGreen 
    : ValidationDashboard._cCyanInfo;
d.DrawGaugeArc(tpzrCenter, 24f, s.T_pzr, 50f, 600f, tpzrColor,
    "T_PZR", $"{s.T_pzr:F1}", "Â°F");
y += 70f;
```

**Rationale:**
- Places T_pzr gauge after LEVEL gauge, before volumes
- Uses same 24f radius as LEVEL gauge for visual consistency
- Range 50-600Â°F covers cold startup (100Â°F) through saturation (450Â°F) with margin
- Color-coded: green when at saturation (ready for bubble), cyan otherwise

### Stage 2: Remove T_pzr Readout from RCS Column

**File:** `Assets/Scripts/Validation/Tabs/OverviewTab.cs`

**Location:** `DrawRCSColumn()` method, around line 225

**Current code to remove:**
```csharp
d.DrawDigitalReadout(new Rect(_rcsCol.x + 4f, y, readoutW, 16f),
    "T_PZR", s.T_pzr, "Â°F", "F1", ValidationDashboard._cTextPrimary);
y += 18f;
```

**Rationale:**
- T_pzr is a pressurizer parameter, not an RCS parameter
- Removing it eliminates duplication and improves logical grouping
- Subsequent readouts shift up to fill gap

### Stage 3: Add T_pzr Sparkline Trend (Replace NET HEAT)

**File:** `Assets/Scripts/Validation/ValidationDashboard.Sparklines.cs`

**Changes:**

1. **Rename constant** (line ~257):
```csharp
// Change from:
public const int IDX_NET_HEAT = 7;
// To:
public const int IDX_T_PZR = 7;
```

2. **Update Initialize()** method â€” replace NET HEAT configuration with T_PZR:
```csharp
// T_pzr: 50-600Â°F (replaces NET HEAT)
_sparklines[IDX_T_PZR] = new SparklineRenderer(width, height, 50f, 600f);
_sparklines[IDX_T_PZR].SetLineColor(ValidationDashboard._cWarningAmber);
_labels[IDX_T_PZR] = "T_PZR";
_formats[IDX_T_PZR] = "F1";
_units[IDX_T_PZR] = "Â°F";
_colors[IDX_T_PZR] = ValidationDashboard._cWarningAmber;
```

3. **Update PushValues()** method:
```csharp
// Change from:
float netHeat = snapshot.RcpHeat + snapshot.PzrHeaterPower 
              - snapshot.SgHeatTransfer - snapshot.RhrNetHeat;
_sparklines[IDX_NET_HEAT].Push(netHeat);

// To:
_sparklines[IDX_T_PZR].Push(snapshot.T_pzr);
```

**Rationale:**
- T_PZR is a primary operational parameter during cold startup
- NET HEAT was a calculated diagnostic value, less operationally critical
- Sparkline provides ~1 hour of T_pzr history for trajectory visualization
- Amber color matches T_AVG sparkline (temperature parameters)
- Range 50-600Â°F matches the arc gauge

### Stage 4: Validation & Documentation

1. Verify compile success
2. Visual inspection of dashboard layout
3. Verify sparkline updates correctly during simulation
4. Verify PZR saturation monitoring behavior and annunciation acceptance (CS-0108)
5. Update CS-0108 and CS-0111 status to CLOSED
6. Update IP-0051 status to CLOSED
7. Create changelog entry (CHANGELOG_v1.0.2.0.md)

---

## 7. Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| PZR column overcrowding | LOW | MEDIUM | Gauge radius matches existing; layout tested |
| RCS column visual gap | LOW | LOW | Readouts shift up naturally |
| Loss of NET HEAT diagnostic | LOW | LOW | Calculated value can be restored if needed |

**Affected Systems:**
- `ValidationDashboard` display rendering only
- No physics modules affected

---

## 8. Unaddressed Issues

None. CS-0108 and CS-0111 are both in scope for this IP.

---

## 9. Revision History

| Revision | Date | Author | Summary | Reason |
|----------|------|--------|---------|--------|
| v1.0 | 2026-02-17 | Codex | Initial IP creation with expanded scope | CS-0111 investigation complete; scope expanded to include sparkline trend |
| v1.1 | 2026-02-18 | Codex | Added reopened CS-0108 to scope and attached it to IP-0051 per governance reassignment. | Align active scope with reopened issue status and user-directed reassignment. |

---

## 10. Approval

**Status:** PENDING APPROVAL

This IP addresses visualization gaps identified during cold startup monitoring review. Changes are display-only with no physics impact. The expanded scope includes:

1. T_pzr arc gauge in PZR column
2. T_pzr readout relocation (RCS â†’ PZR column removal)
3. T_pzr sparkline trend (replaces NET HEAT)

**Approval Required:** User authorization needed before execution may proceed.
